(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{1774:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"d",(function(){return p})),n.d(e,"e",(function(){return c})),n.d(e,"f",(function(){return b})),n.d(e,"g",(function(){return s})),n.d(e,"h",(function(){return g})),n.d(e,"i",(function(){return o}));var r=function(t,e,n){var r;return function(){var a=null,i=arguments,o=function(){r=null,n||t.apply(a,i)},s=n&&!r;clearTimeout(r),r=window.setTimeout(o,e),s&&t.apply(a,i)}},a=function(t){var e=t.replace("#","");return.299*parseInt(e.slice(0,2),16)+.587*parseInt(e.slice(2,4),16)+.114*parseInt(e.slice(4,6),16)>186?"#000000":"#FFFFFF"},i=function(t){var e="";if(t>=60&&t<3600){var n=Math.floor(t/60);e=n+" Min";var r=60===n?0:Math.floor(t%60);return e+(r>0?" "+r+" Sec":"")}if(t>=3600&&t<86400){var a=Math.floor(t/3600);e=a+" Hr";var i=t%3600<60||24===a?0:Math.floor(t%3600/60);return e+(i>0?" "+i+" Min":"")}if(t>=86400){var o=Math.floor(t/86400);e=o+" Day";var s=t%86400<3600||o>=364?0:Math.floor(t%86400/3600);return e+(s>0?" "+s+" Hr":"")}return Math.floor(t)+" Sec"},o=function(t,e,n){void 0===t&&(t=""),void 0===e&&(e=1024),void 0===n&&(n=!1);var r=t;return t.length>e&&(r=t.substring(0,e)),n&&(r+="..."),r};function s(t){try{var e=String(t).toLowerCase();return Boolean(JSON.parse(e))}catch(n){return!1}}function u(t){return t.slice().sort((function(t,e){return t-e}))}function l(t,e){var n,r,a,i=(r=1,(a=e)<(n=0)?n:a>r?r:a),o=(t.length-1)*i,s=Math.floor(o),u=o-s;return void 0!==t[s+1]?t[s]+u*(t[s+1]-t[s]):t[s]}var c=function(t,e){var n=u(t);return e.map((function(t){return l(n,t)}))},f=/{{(.*?)}}/g,d=function(t){return(t||"").replace(/\b(\w)/g,(function(t){return t.toUpperCase()}))},h=function(t){var e=t.user,n=null!=e&&e.name?e.name.split(" ").shift():"";return d(n)},m=function(t){var e=t.user;if(e&&e.name){var n=e.name.split(" ").length>1?e.name.split(" ").pop():"";return d(n)}return""},p=function(t){var e,n=t.conversation,r=n.meta,a=r.assignee,i=r.sender,o=n.id;return{"contact.name":d((null==i?void 0:i.name)||""),"contact.first_name":h({user:i}),"contact.last_name":m({user:i}),"contact.email":null==i?void 0:i.email,"contact.phone":null==i?void 0:i.phone_number,"contact.id":null==i?void 0:i.id,"conversation.id":o,"agent.name":d((null==a?void 0:a.name)||""),"agent.first_name":h({user:a}),"agent.last_name":m({user:a}),"agent.email":null!=(e=null==a?void 0:a.email)?e:""}},g=function(t){var e=t.message,n=t.variables;return e.replace(f,(function(t,e){return n[e.trim()]?n[e.trim().toLowerCase()]:""}))},b=function(t){var e=t.message,n=t.variables,r=e.replace(/```(?:.|\n)+?```/g,"").match(f);return r?r.map((function(t){return t.replace("{{","").replace("}}","").trim()})).filter((function(t){return!n[t]})):[]}},1912:function(t,e,n){"use strict";n(64),n(49),n(65),n(1913),n(136),n(16),n(7),n(20),n(21),n(196),n(9);var r=n(1915),a=n.n(r),i=(n(370),/mention:\/\/(user|team)\/(\d+)\/(.+)/gm);function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var u=function(t){t.children.forEach((function(t){"image"===t.type&&function(t){var e=t.attrGet("src");if(e){var n=new URL(e).searchParams.get("cw_image_height");n&&t.attrSet("style","height: ".concat(n,";"))}}(t)}))},l=n(1807)({html:!1,xhtmlOut:!0,breaks:!0,langPrefix:"language-",linkify:!0,typographer:!0,quotes:"\u201c\u201d\u2018\u2019",maxNesting:20}).use((function(t){t.renderer.rules.mention=function(t,e){return'<span class="prosemirror-mention-node">'.concat(t[e].content,"</span>")},t.inline.ruler.before("link","mention",(function(t,e){var n,r,a,o,s,u,l="",c=t.posMax;return 91===t.src.charCodeAt(t.pos)&&(a=t.pos+1,!((r=t.md.helpers.parseLinkLabel(t,t.pos,!0))<0)&&(n=t.src.slice(a,r),(o=r+1)<c&&40===t.src.charCodeAt(o)&&(o+=1,(s=t.md.helpers.parseLinkDestination(t.src,o,t.posMax)).ok&&(l=t.md.normalizeLink(s.str),t.md.validateLink(l)?o=s.pos:l=""),o+=1),!!l.match(new RegExp(i))&&(e||(t.pos=a,t.posMax=r,(u=t.push("mention","")).href=l,u.content=n),t.pos=o,t.posMax=c,!0)))}))})).use((function(t){t.core.ruler.after("inline","add-image-height",(function(t){t.tokens.forEach((function(t){"inline"===t.type&&u(t)}))}))})).use(a.a,{attrs:{class:"link",rel:"noreferrer noopener nofollow",target:"_blank"}}),c=/(^|[^@\w])@(\w{1,15})\b/g,f=/(^|\s)#(\w+)/g,d=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];o(this,t),this.message=e||"",this.isAPrivateNote=r,this.isATweet=n}var e,n,r;return e=t,(n=[{key:"formatMessage",value:function(){var t=this.message;return this.isATweet&&!this.isAPrivateNote&&(t=(t=t.replace(c,"$1[@$2](http://twitter.com/$2)")).replace(f,"$1[#$2](https://twitter.com/hashtag/$2)")),l.render(t)}},{key:"formattedMessage",get:function(){return this.formatMessage()}},{key:"plainText",get:function(){return(new DOMParser).parseFromString(this.formattedMessage,"text/html").body.textContent||""}}])&&s(e.prototype,n),r&&s(e,r),t}(),h=d;e.a={methods:{formatMessage:function(t,e,n){return new h(t,e,n).formattedMessage},getPlainText:function(t,e){return new h(t,e).plainText},truncateMessage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t.length<100?t:"".concat(t.slice(0,97),"...")},highlightContent:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=this.getPlainText(t),a=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return r.replace(new RegExp("(".concat(a,")"),"ig"),'<span class="'.concat(n,'">$1</span>'))}}}},1913:function(t,e,n){var r=n(35),a=n(15),i=n(110),o=n(197),s=n(38).f,u=n(94).f,l=n(226),c=n(172),f=n(209),d=n(43),h=n(19),m=n(61).enforce,p=n(198),g=n(17)("match"),b=a.RegExp,v=b.prototype,C=/a/g,y=/a/g,E=new b(C)!==C,x=f.UNSUPPORTED_Y;if(r&&i("RegExp",!E||x||h((function(){return y[g]=!1,b(C)!=C||b(y)==y||"/a/i"!=b(C,"i")})))){for(var _=function(t,e){var n,r=this instanceof _,a=l(t),i=void 0===e;if(!r&&a&&t.constructor===_&&i)return t;E?a&&!i&&(t=t.source):t instanceof _&&(i&&(e=c.call(t)),t=t.source),x&&(n=!!e&&e.indexOf("y")>-1)&&(e=e.replace(/y/g,""));var s=o(E?new b(t,e):b(t,e),r?this:v,_);x&&n&&(m(s).sticky=!0);return s},O=function(t){t in _||s(_,t,{configurable:!0,get:function(){return b[t]},set:function(e){b[t]=e}})},A=u(b),k=0;A.length>k;)O(A[k++]);v.constructor=_,_.prototype=v,d(a,"RegExp",_)}p("RegExp")},1915:function(t,e,n){"use strict";function r(t,e){e=e?Array.isArray(e)?e:[e]:[],Object.freeze(e);var n=t.renderer.rules.link_open||this.defaultRender;t.renderer.rules.link_open=function(t,r,a,i,o){var s=function(t,e){var n,r,a=t.attrs[t.attrIndex("href")][1];for(n=0;n<e.length;++n){if("function"!==typeof(r=e[n]).matcher)return r;if(r.matcher(a,r))return r}}(t[r],e),u=s&&s.attrs;return u&&function(t,e,n){Object.keys(n).forEach((function(r){var a,i=n[r];"className"===r&&(r="class"),(a=e[t].attrIndex(r))<0?e[t].attrPush([r,i]):e[t].attrs[a][1]=i}))}(r,t,u),n(t,r,a,i,o)}}r.defaultRender=function(t,e,n,r,a){return a.renderToken(t,e,n)},t.exports=r},1937:function(t,e,n){"use strict";n(10);var r={props:{block:{type:Boolean,default:!1},type:{type:String,default:"blue"},bgColor:{type:String,default:""},textColor:{type:String,default:""},disabled:{type:Boolean,default:!1}},computed:{buttonClassName:function(){var t="text-white py-3 px-4 rounded shadow-sm leading-4";return"clear"===this.type&&(t="flex mx-auto mt-4 text-xs leading-3 w-auto text-black-600"),"blue"!==this.type||Object.keys(this.buttonStyles).length||(t="".concat(t," bg-woot-500 hover:bg-woot-700")),this.block&&(t="".concat(t," w-full")),t},buttonStyles:function(){var t={};return this.bgColor&&(t.backgroundColor=this.bgColor),this.textColor&&(t.color=this.textColor),t}},methods:{onClick:function(t){this.$emit("click",t)}}},a=n(5),i=Object(a.a)(r,(function(){var t=this;return(0,t._self._c)("button",{class:t.buttonClassName,style:t.buttonStyles,attrs:{disabled:t.disabled},on:{click:t.onClick}},[t._t("default")],2)}),[],!1,null,null,null);e.a=i.exports},2996:function(t,e,n){},3307:function(t,e,n){"use strict";n(2996)},3367:function(t,e,n){"use strict";n.r(e);n(8),n(37),n(83),n(9),n(41),n(141),n(16),n(7),n(21),n(10),n(68),n(97),n(4),n(11),n(12);var r=n(1937),a=n(170),i=n(25),o=n(1774),s=n(1912),u=n(89),l=n(1784),c=n(298),f=n(352);function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){m(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var p={components:{CustomButton:r.a,Spinner:a.a},mixins:[l.a,c.a,s.a,f.a],props:{options:{type:Object,default:function(){}}},data:function(){return{locale:this.$root.$i18n.locale,hasErrorInPhoneInput:!1,message:"",formValues:{},labels:{emailAddress:"EMAIL_ADDRESS",fullName:"FULL_NAME",phoneNumber:"PHONE_NUMBER"}}},computed:h(h({},Object(i.mapGetters)({widgetColor:"appConfig/getWidgetColor",isCreating:"conversation/getIsCreating",activeCampaign:"campaign/getActiveCampaign",currentUser:"contacts/getCurrentUser"})),{},{textColor:function(){return Object(o.c)(this.widgetColor)},hasActiveCampaign:function(){return!Object(u.d)(this.activeCampaign)},shouldShowHeaderMessage:function(){return this.hasActiveCampaign||this.preChatFormEnabled},headerMessage:function(){return this.preChatFormEnabled?this.options.preChatMessage:this.hasActiveCampaign?this.$t("PRE_CHAT_FORM.CAMPAIGN_HEADER"):""},preChatFields:function(){return this.preChatFormEnabled?this.options.preChatFields:[]},filteredPreChatFields:function(){var t=!!this.currentUser.email,e=!!this.currentUser.phone_number,n=!!(!!this.currentUser.identifier||t||e);return this.preChatFields.filter((function(r){return(!t||"emailAddress"!==r.name)&&((!e||"phoneNumber"!==r.name)&&(!n||"fullName"!==r.name))}))},enabledPreChatFields:function(){var t=this;return this.filteredPreChatFields.filter((function(t){return t.enabled})).map((function(e){return h(h({},e),{},{type:"phoneNumber"===e.name?"phoneInput":t.findFieldType(e.type)})}))},conversationCustomAttributes:function(){var t=this,e={};return this.enabledPreChatFields.forEach((function(n){"conversation_attribute"===n.field_type&&(e=h(h({},e),{},m({},n.name,t.getValue(n))))})),e},contactCustomAttributes:function(){var t=this,e={};return this.enabledPreChatFields.forEach((function(n){"contact_attribute"===n.field_type&&(e=h(h({},e),{},m({},n.name,t.getValue(n))))})),e},inputStyles:function(){return"mt-1 border rounded w-full py-2 px-3 text-slate-700 outline-none"},isInputDarkOrLightMode:function(){return"".concat(this.$dm("bg-white","dark:bg-slate-600")," ").concat(this.$dm("text-slate-700","dark:text-slate-50"))},inputBorderColor:function(){return"".concat(this.$dm("border-black-200","dark:border-black-500"))}}),methods:{labelClass:function(t){var e=t.hasErrors;return"text-xs font-medium ".concat(e?this.$dm("text-red-400","dark:text-red-400"):this.$dm("text-black-800","dark:text-slate-50"))},inputClass:function(t){var e=t.hasErrors,n=t.classification,r=t.type;return"box"===n&&"checkbox"===r?"":("phoneInput"===r&&(this.hasErrorInPhoneInput=e),e?"".concat(this.inputStyles," border-red-200 hover:border-red-300 focus:border-red-300 ").concat(this.isInputDarkOrLightMode):"".concat(this.inputStyles," hover:border-black-300 focus:border-black-300 ").concat(this.isInputDarkOrLightMode," ").concat(this.inputBorderColor))},isContactFieldRequired:function(t){return this.preChatFields.find((function(e){return e.name===t})).required},getLabel:function(t){return t.label},getPlaceHolder:function(t){return t.placeholder},getValue:function(t){var e=t.name;return"select"===t.type?this.enabledPreChatFields.find((function(t){return t.name===e})).values[this.formValues[e]]:this.formValues[e]||null},getValidation:function(t){var e=t.type,n=t.name,r={emailAddress:"email",phoneNumber:"startsWithPlus|isValidPhoneNumber",url:"url",date:"date",text:null,select:null,number:null,checkbox:!1},a=Object.keys(r),i=this.isContactFieldRequired(n)?"bail|required":"bail|optional";if(a.includes(n)||a.includes(e)){var o=r[e]||r[n];return o?"".concat(i,"|").concat(o):i}return""},findFieldType:function(t){return"link"===t?"url":"list"===t?"select":t},getOptions:function(t){if("select"===t.type){var e={};return t.values.forEach((function(t,n){e=h(h({},e),{},m({},n,t))})),e}return null},onSubmit:function(){var t=this.formValues,e=t.emailAddress,n=t.fullName,r=t.phoneNumber,a=t.message,i=this.currentUser.email;this.$emit("submit",{fullName:n,phoneNumber:r,emailAddress:e||i,message:a,activeCampaignId:this.activeCampaign.id,conversationCustomAttributes:this.conversationCustomAttributes,contactCustomAttributes:this.contactCustomAttributes})}}},g=(n(3307),n(5)),b=Object(g.a)(p,(function(){var t=this,e=t._self._c;return e("FormulateForm",{staticClass:"flex flex-1 flex-col p-6 overflow-y-auto",on:{submit:t.onSubmit},model:{value:t.formValues,callback:function(e){t.formValues=e},expression:"formValues"}},[t.shouldShowHeaderMessage?e("div",{directives:[{name:"dompurify-html",rawName:"v-dompurify-html",value:t.formatMessage(t.headerMessage,!1),expression:"formatMessage(headerMessage, false)"}],staticClass:"mb-4 text-sm leading-5 pre-chat-header-message",class:t.$dm("text-black-800","dark:text-slate-50")}):t._e(),t._v(" "),t._l(t.enabledPreChatFields,(function(n){return e("FormulateInput",{key:n.name,attrs:{name:n.name,type:n.type,label:t.getLabel(n),placeholder:t.getPlaceHolder(n),validation:t.getValidation(n),options:t.getOptions(n),"label-class":e=>t.labelClass(e),"input-class":e=>t.inputClass(e),"validation-messages":{startsWithPlus:t.$t("PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.DIAL_CODE_VALID_ERROR"),isValidPhoneNumber:t.$t("PRE_CHAT_FORM.FIELDS.PHONE_NUMBER.VALID_ERROR"),email:t.$t("PRE_CHAT_FORM.FIELDS.EMAIL_ADDRESS.VALID_ERROR"),required:t.$t("PRE_CHAT_FORM.REQUIRED")},"has-error-in-phone-input":t.hasErrorInPhoneInput}})})),t._v(" "),t.hasActiveCampaign?t._e():e("FormulateInput",{attrs:{name:"message",type:"textarea","label-class":e=>t.labelClass(e),"input-class":e=>t.inputClass(e),label:t.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.LABEL"),placeholder:t.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.PLACEHOLDER"),validation:"required","validation-messages":{required:t.$t("PRE_CHAT_FORM.FIELDS.MESSAGE.ERROR")}}}),t._v(" "),e("custom-button",{staticClass:"font-medium mt-2 mb-5",attrs:{block:"","bg-color":t.widgetColor,"text-color":t.textColor,disabled:t.isCreating}},[t.isCreating?e("spinner",{staticClass:"p-0"}):t._e(),t._v("\n    "+t._s(t.$t("START_CONVERSATION"))+"\n  ")],1)],2)}),[],!1,null,"618e6854",null).exports,v=n(302),C={components:{PreChatForm:b},mixins:[f.a,l.a],mounted:function(){var t=this;bus.$on(v.c,(function(){t.replaceRoute("messages")}))},methods:{onSubmit:function(t){var e=t.fullName,n=t.emailAddress,r=t.message,a=t.activeCampaignId,i=t.phoneNumber,o=t.contactCustomAttributes,s=t.conversationCustomAttributes;a?(bus.$emit("execute-campaign",{campaignId:a,customAttributes:s}),this.$store.dispatch("contacts/update",{user:{email:n,name:e,phone_number:i}})):this.$store.dispatch("conversation/createConversation",{fullName:e,emailAddress:n,message:r,phoneNumber:i,customAttributes:s}),Object(u.d)(o)||this.$store.dispatch("contacts/setCustomAttributes",o)}}},y=Object(g.a)(C,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"flex flex-1 overflow-auto"},[e("pre-chat-form",{attrs:{options:t.preChatFormOptions},on:{submit:t.onSubmit}})],1)}),[],!1,null,null,null);e.default=y.exports}}]);
//# sourceMappingURL=61-b76e619ce295e4931745.chunk.js.map